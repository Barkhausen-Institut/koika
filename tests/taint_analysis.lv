;;; Unit tests to ensure that impure functions are not optimized out

(extfun impure () (bits 5))

(module taint
  (cpp-preamble "
class extfuns {
  bits<5> state{0u};
public:
  bits<5> impure(const unit& /*ignored*/) {
    state = state + bits<5>{1u};
    return state;
  }
};")

  (rule keep_impure_exprs
    (ignore (+ (impure) (impure))))

  (scheduler s (sequence)))
